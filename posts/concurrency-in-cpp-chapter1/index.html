<!DOCTYPE html><html lang="fa-IR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="همزمانی در سی++: مفاهیم اولیه" /><meta name="author" content="سیدپولر" /><meta property="og:locale" content="fa_IR" /><meta name="description" content="بالاخره شروع کردم به خوندن کتاب C++ Concurrency in action نوشته Anthony Williams. این کتاب رو باید یک ماه پیش تموم می‌کردم اما مثل همیشه خیلی کند پیش رفتم و فقط ۲ فصلش رو تا الآن خوندم و تازه دارم خلاصه فصل اول رو می‌نویسم. به خودم قول دادم که توی این هفته این کتابو تموم کنم و باید انجامش بدم." /><meta property="og:description" content="بالاخره شروع کردم به خوندن کتاب C++ Concurrency in action نوشته Anthony Williams. این کتاب رو باید یک ماه پیش تموم می‌کردم اما مثل همیشه خیلی کند پیش رفتم و فقط ۲ فصلش رو تا الآن خوندم و تازه دارم خلاصه فصل اول رو می‌نویسم. به خودم قول دادم که توی این هفته این کتابو تموم کنم و باید انجامش بدم." /><link rel="canonical" href="https://www.seedpuller.ir/posts/concurrency-in-cpp-chapter1/" /><meta property="og:url" content="https://www.seedpuller.ir/posts/concurrency-in-cpp-chapter1/" /><meta property="og:site_name" content="سیدپولر" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-09-24T00:00:00+03:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="همزمانی در سی++: مفاهیم اولیه" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@سیدپولر" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"سیدپولر"},"description":"بالاخره شروع کردم به خوندن کتاب C++ Concurrency in action نوشته Anthony Williams. این کتاب رو باید یک ماه پیش تموم می‌کردم اما مثل همیشه خیلی کند پیش رفتم و فقط ۲ فصلش رو تا الآن خوندم و تازه دارم خلاصه فصل اول رو می‌نویسم. به خودم قول دادم که توی این هفته این کتابو تموم کنم و باید انجامش بدم.","url":"https://www.seedpuller.ir/posts/concurrency-in-cpp-chapter1/","@type":"BlogPosting","headline":"همزمانی در سی++: مفاهیم اولیه","dateModified":"2021-05-04T00:48:09+04:30","datePublished":"2020-09-24T00:00:00+03:30","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.seedpuller.ir/posts/concurrency-in-cpp-chapter1/"},"@context":"https://schema.org"}</script><title>همزمانی در سی++: مفاهیم اولیه | سیدپولر</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/24620298?s=460&u=dd6165c7d8103164b24d6f40a169594a2c8dac42&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">سیدپولر</a></div><div class="site-subtitle font-italic">نوشته های مور دانه‌کش</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/SeedPuller" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['SeedPuller','gmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>همزمانی در سی++: مفاهیم اولیه</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8" style="direction: rtl; text-align: right;"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip style="direction: rtl; text-align: right;">همزمانی در سی++: مفاهیم اولیه</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Sep 24, 2020, 12:00 AM +0330" > Sep 24, 2020 <i class="unloaded">2020-09-24T00:00:00+03:30</i> </span> توسط <span class="author"> سیدپولر </span></div><div> <span> بروز شده در <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, May 4, 2021, 12:48 AM +0430" > May 4, 2021 <i class="unloaded">2021-05-04T00:48:09+04:30</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="حاوی 1509 کلمه"> 8 دقیقه</span></div></div><div class="post-content"><p>بالاخره شروع کردم به خوندن کتاب C++ Concurrency in action نوشته Anthony Williams. این کتاب رو باید یک ماه پیش تموم می‌کردم اما مثل همیشه خیلی کند پیش رفتم و فقط ۲ فصلش رو تا الآن خوندم و تازه دارم خلاصه فصل اول رو می‌نویسم. به خودم قول دادم که توی این هفته این کتابو تموم کنم و <strong>باید انجامش بدم</strong>.</p><p>این کتاب درباره همزمانی در سی++ عه و راجع به نحوه نوشتن برنامه های این چنینی و چالش های پیش رو و راه های مرسوم برای حل چالش ها صحبت می‌کنه. یجورایی معروف ترین کتاب در این زمینه‌ست و خود نویسنده‌ش در کمیته استاندارد سی++ در همین بخش کار می‌کنه و پروپوزال میده.</p><p>با اینکه کتاب از مفاهیم پایه شروع به توضیح کرده، به نظرم بهتره آدم قبلش معماری کامپیوتر بدونه تا خیلی راحت تر بفهمه که چی به چیه.</p><h2 id="همزمانیconcurrency-چیست">همزمانی(Concurrency) چیست؟</h2><p>همزمانی درواقع به معنی انجام دادن چندکار در یک زمان واحده. به عنوان مثال میشه به وقتی که داریم راه می‌ریم و همزمان تلفن رو با دستمون نگه داشتیم و داریم چت می‌کنیم اشاره کرد. اینکار هارو به شکل همزمان انجام می‌دیم.</p><h2 id="همزمانی-در-کامپیوتر">همزمانی در کامپیوتر</h2><p>همونطور که می‌دونیم، کامپیوتر ها در حالت عادی کار هارو به شکل ترتیبی از دستورات پشت سر هم انجام می‌دن.</p><p>وقتی از همزمانی در کامپیوتر صحبت می‌کنیم یعنی یک سیستم چندین کار رو به شکل همزمان و موازی انجام بده. حالا میخواد از طریق Task switching باشه یا به معنای واقعی کلمه همزمان باشه.</p><p>همزمانی از زمان های خیلی قدیم تر هم بوده. از سیستم عامل های Multi task که میتونستن چندکار رو با استفاده از task switching انجام بدن گرفته تا سرورهایی که چندین پردازنده داشتن و رسما به شکل موازی کار هارو انجام می‌دادن. اما در دنیای امروز، استفاده از سیستم هایی که به شکل سخت افزاری میتونن وظایف رو به شکل همزمان انجام بدن بسیار بسیار بیشتر شده و به همین دلیله که همه باید بلد باشیم چطور باید با این کامپیوتر ها کار کرد.</p><p>همونطور که گفتم، قبلا کامپیوتر ها کلا از دو روش برای انجام همزمان کارها استفاده می‌کردن:</p><h3 id="جابجایی-بین-وظایفtask-switching">جابجایی بین وظایف(task switching)</h3><p>کامپیوتر هایی که یک پردازنده داشتن، از لحاظ تئوری امکان اینکه چند کار رو به شکل همزمان انجام بدن وجود نداشت. پس چطور اینکار رو انجام می‌دادن؟</p><p>با تقسیم کردن وظایف به چند قسمت و انجام دادن یه تیکه از هر وظیفه. یعنی چی؟ یعنی پردازنده در ثانیه بین وظایف مختلف پرش انجام میده و هربار یکم از کار هرکدوم رو انجام می‌ده. اینکار انقدر سریعه که انگار برنامه ها دارن باهمدیگه اجرا می‌شن و یجور <strong>توهم همزمانی</strong> رو ایجاد میکنه.</p><h3 id="همزمانی-سخت-افزاریhardware-concurrency">همزمانی سخت افزاری(hardware concurrency)</h3><p>کامپیوتر هایی که چند پردازنده دارن یا اونایی که یک پردازنده چند هسته ای دارن میتونن واقعا کارها رو به شکل همزمان انجام بدن</p><p>درحالت کلی، task switching بسیار کُند تر از همزمانی سخت افزاریه چرا که در حالت اول، پردازنده باید فرآیندی رو به نام _context sw_itch رو انجام بده. خلاصه‌ش اینه که وقتی میخواد از یک کاری به کار دیگه پرش انجام بده، باید state ای که cpu داره رو ذخیره کنه و همچنین اشاره گر به دستوری که میخواسته اجرا کنه رو هم ذخیره کنه. بعد به کار بعدی پرش انجام بده و اونجا state مربوط به اون وظیفه رو بازیابی کنه، دستورات موجود در حافظه رو بارگزاری کنه تا بتونه شروع به پردازش اون وظیفه کنه. همه اینکار ها باعث میشن که تاخیر بیشتری در انجام کارها صورت بگیره. تصویر زیر کاملا این مطلب رو روشن می‌کنه. دو task داریم که هرکدوم به ۱۰ قسمت تقسیم شده‌ن(یک task با رنگ قرمز و دیگری سبز).</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://mark.nl.tab.digital/s/JQTsQntcTBLrRig/preview" alt="picture" class="normal" /> <em>مقایسه اجرای دو کار روی یک پردازنده تک هسته ای و یک پردازنده دو هسته ای</em></p><h2 id="رویکرد-های-همزمانی">رویکرد های همزمانی</h2><p>اساسا از دو چیز برای پیاده سازی همزمانی استفاده میشه:</p><ul><li>ترد ها/ نخ ها/ threads<li>پروسه ها/ پردازه ها/ processes</ul><p>دو کارمند رو تصور کنید که میخوان در یک شرکت روی یک پروژه کار کنن. ایده اول اینه که به هرکدوم یک اتاق جدا بدیم و همچنین یک کپی از راهنمای نرم افزاری که میخوان روش کار کنن هم به هرکدوم بدیم. چالش هایی که روبه‌رومونه ایناست:</p><ul><li>باید دوتا اتاق رو مدیریت کنیم<li>دوتا کارمند برای صحبت کردن با همدیگه مجبورن از جاشون بلند شن و برن پیش همدیگه<li>از هر چیزی باید دوتا کپی بگیریم و بهشون بدیم</ul><p>ایده دوم اینه که هردو نفر رو در یک اتاق بذاریم و اینطوری کافیه یه کپی از راهنمای نرم افزار رو بهشون بدیم. فرق این روش چیه؟</p><ul><li>تمرکز کردن احتمالا براشون سخت تر میشه<li>نیاز نیست که چندین کپی از منابع بگیریم اما ممکنه هردوتاشون به یک چیز ثابت نیاز داشته باشن و اینطوری باید صبر کنن تا کار شخص دیگر تموم بشه.<li>میتونن به راحتی با هم صحبت کنن و ایده هاشون رو به اشتراک بذارن.</ul><p>با استفاده از این مثال میتونیم دو رویکرد اساسی رو بررسی کنیم.</p><p>کارمند هارو به عنوان ترد ها و اتاق هارو به عنوان پروسه ها در نظر می‌گیریم.</p><p>بنابراین دو رویکرد ما به این صورت خواهند بود:</p><ul><li>چند پروسه تک-نخی<li>یک پروسه چند-نخی</ul><h4 id="چند-پروسه-تک-نخی">چند پروسه تک-نخی</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://seedpuller.space/wp-content/uploads/2020/09/image-2.png" alt="" /></p><p>دو پروسه صرفا با استفاده از IPC میتونن باهم ارتباط برقرار کنن و این باعث میشه سرعت اجرای کارها پایین بیاد چرا که سیستم عامل لایه های محافظتی ای رو اعمال می‌کنه که یک پروسه نتونه داده های پروسه های دیگه رو ویرایش کنه یا به راحتی بخونه.</p><p>از طرف دیگه اجرای پروسه های زمان بیشتری نیاز داره.</p><p>اما خوبی هایی هم داره: اضافه شدن لایه های انتزاعی کمک میکنه که نیاز نباشه برنامه پیچیده ای برای ارتباط نوشته بشه و بیشتر کار رو خود سیستم عامل انجام میده و همچنین، این قابلیت ایجاد میشه که یک وظیفه رو بین <strong>چند کامپیوتر‌</strong> در شبکه تقسیم کرد.</p><h4 id="یک-پروسه-چند-نخی">یک پروسه چند-نخی</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://seedpuller.space/wp-content/uploads/2020/09/image-3.png" alt="" /></p><p>رویکرد دیگه ای که ازش استفاده می‌شه، نوشتن یک برنامه چند نخی‌ست.</p><p>ترد ها یجورایی همون ساده شدهٔ پروسه ها هستن. یک پروسه میتونه از چندین ترد تشکیل بشه و بیشتر اطلاعات میتونن از طریق حافظه به اشتراک گذاری شده (shared memory) بین ترد ها جابجا بشن. ترد ها دیگه اون سربار مربوط به محافظت های سیستم عامل رو ندارن به همین دلیل سریعترن و درواقع اکثر برنامه نویس ها از این روش برای پیاده سازی همزمانی استفاده می‌کنن.</p><p>خود سی++ هم راهکار خاصی برای پیاده سازی رویکرد «پروسه های تک-نخی» نداره و برای پیاده سازیش باید به API های سیستم متکی بود.</p><p>اما ترد ها یه مشکلی دارن و اونم اینه که باید مطمئن بشیم اون دادهٔ اشتراکی که چند ترد میخوان بخوننش، برای همه ثابت باشه.</p><p>راهکار های بسیاری برای حل این مشکل وجود داره که بسته به سناریو میشه ازشون استفاده کرد و این چالش رو هم حل کرد.</p><h2 id="تفاوت-همزمانی-با-موازی-کاریconcurrency-vs-parallelism">تفاوت همزمانی با موازی کاری(Concurrency vs. Parallelism)</h2><p>یکی از کلماتی که در حوزه برنامه نویسی چند نخی شنیده میشه، موازی کاری یا parallelism است.</p><p>این دو مفهوم همپوشانی بسیار زیادی باهم دارن اما با هم متفاوتن.</p><p>در حالت کلی هردو مفهوم درباره اجرا کردن چند وظیفه به شکل همزمان و موازی هستن اما هدف‌شون فرق می‌کنه.</p><p>هدف موازی‌کاری، <strong>افزایش کارایی و performance</strong> هست. اینکه سریعتر یک سری پردازش روی داده ها انجام بشه.</p><p>هدف همزمانی، جدا کردن بخش های مختلف برنامه یا به عبارت دیگه <em><strong>Separation of Concerns</strong></em> هست.</p><h2 id="همزمانی-برای-جدا-کردن-بخش-های-مختلف">همزمانی برای جدا کردن بخش های مختلف</h2><p>اینکه ما بتونیم بخش هایی که به همدیگه مربوطن رو نزدیک هم نگه داریم و بخش هایی که ربطی به همدیگه ندارن رو از هم دور کنیم باعث میشه مدیریت کردن کد و برنامه راحت تر بشه و بخش های مختلف برنامه جدا از همدیگه [و به صورت موازی] کار کنن.</p><p>به عنوان مثال یک برنامه DVD Player رو در نظر می‌گیریم. این برنامه چندین کار رو همزمان باید انجام بده:</p><ul><li>دیکد کردن فایل ویدئویی<li>پخش کردن تصویر<li>پخش کردن صدا<li>ارتباط با کاربر(مثلا برای متوقف کردن پخش)</ul><p>بدون استفاده از همزمانی، این کار ها نمیتونن به شکل همزمان باهمدیگه انجام بشن (:</p><h2 id="همزمانی-برای-افزایش-کارایی">همزمانی برای افزایش کارایی</h2><p>این رویکرد، برای کاهش زمان اجرای الگوریتم بکار می‌ره و دو روش اصلی اون عبارت اند از:</p><ul><li>یک کار ثابت رو به چند قسمت تقسیم کنیم و هر قسمت به شکل موازی باهمدیگه انجام بشن. درواقع به این معنیه که هر ترد یک بخشی از الگوریتم رو انجام بده. به این میگن <em>Task parallelism</em><li>یک داده رو به چند قسمت تقسیم کنیم و یک کار ثابت رو روی قسمت های مختلف داده ها انجام بدیم. به این روش میگن <em>Data Parallelism</em></ul><h3 id="الگوریتم-های-موازی">الگوریتم های موازی</h3><p>به الگوریتم هایی که به راحتی میتونن به شکل موازی اجرا بشن اصطلاحا می‌گن این الگوریتم به شکل خجالت آوری قابل موازی شدنه =)</p><p>الگوریتم های embarrassingly parallel این قابلیت رو دارن که به راحتی به چندین قسمت تقسیم بشن و به شکل موازی به سرانجام برسن. همچنین قابلیت مقیاس پذیری دارن یعنی میشه تعداد قسمت هارو به راحتی تغییر داد.</p><h2 id="پایان">پایان</h2><p>خیلی موضوع جالبیه و نیازمند مطالعه بسیار. توی کتاب معماری کامپیوتر پترسون هم بهش رسیدم و امیدوارم بتونم وقتمو طوری تنظیم کنم که اونو هم بخونم(خیلی تنبلم).</p><p>احتمالا فقط خلاصه بخش هایی رو می‌نویسم که مفهومی ان و راجع به بخش هایی که بیشتر کد نویسی ان چیزی نمی‌نویسم.</p><p>خیلی از بخش های آخر(مثل: «چه زمانی نباید از همزمانی استفاده کنیم؟») رو ننوشتم بخاطر اینکه فکر نمی‌کنم فراموشم بشن</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%D8%B3%DB%8C/'>سی++</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >C++</a> <a href="/tags/concurrency-in-action/" class="post-tag no-text-decoration" >concurrency in action</a> <a href="/tags/concurrent-processing/" class="post-tag no-text-decoration" >concurrent processing</a> <a href="/tags/%D9%85%D9%88%D8%A7%D8%B2%DB%8C-%DA%A9%D8%A7%D8%B1%DB%8C/" class="post-tag no-text-decoration" >موازی کاری</a> <a href="/tags/%D9%87%D9%85%D8%B2%D9%85%D8%A7%D9%86%DB%8C/" class="post-tag no-text-decoration" >همزمانی</a> <a href="/tags/%D8%B3%DB%8C/" class="post-tag no-text-decoration" >سی++</a> <a href="/tags/%D8%B3%DB%8C-%DB%B1%DB%B7/" class="post-tag no-text-decoration" >سی++۱۷</a> <a href="/tags/%DA%86%D9%86%D8%AF-%D9%86%D8%AE%DB%8C/" class="post-tag no-text-decoration" >چند نخی</a> <a href="/tags/%D8%A8%D8%B1%D9%86%D8%A7%D9%85%D9%87-%D9%86%D9%88%DB%8C%D8%B3%DB%8C-%DA%86%D9%86%D8%AF-%D9%86%D8%AE%DB%8C/" class="post-tag no-text-decoration" >برنامه نویسی چند نخی</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> این پست تحت مجوز <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> منتشر شده است.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">اشتراک گذاری</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=همزمانی در سی++: مفاهیم اولیه - سیدپولر&url=https://www.seedpuller.ir/posts/concurrency-in-cpp-chapter1/" data-toggle="tooltip" data-placement="top" title="توئیتر" target="_blank" rel="noopener" aria-label="توئیتر"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://telegram.me/share?text=همزمانی در سی++: مفاهیم اولیه - سیدپولر&url=https://www.seedpuller.ir/posts/concurrency-in-cpp-chapter1/" data-toggle="tooltip" data-placement="top" title="تلگرام" target="_blank" rel="noopener" aria-label="تلگرام"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="کپی لینک پست"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/concurrency-in-cpp-chapter1/">همزمانی در سی++: مفاهیم اولیه</a><li><a href="/posts/concurrency-in-cpp-chapter3-5/">همزمانی در سی++(۵): جایگزین های mutex</a><li><a href="/posts/concurrency-in-cpp-chapter3-3/">همزمانی در سی++(۳): Dead Lock ها</a><li><a href="/posts/concurrency-in-cpp-chapter3-4/">همزمانی در سی++(۴): ژانگولر بازی با mutex و کارهای دیگر</a><li><a href="/posts/concurrency-in-cpp-chapter3-1/">همزمانی در سی++: اشتراک گذاری داده ها(۱)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/%D8%B3%DB%8C/">سی++</a> <a class="post-tag" href="/tags/inner-struggle/">Inner Struggle</a> <a class="post-tag" href="/tags/%D8%AF%D8%A7%DB%8C%D8%AA%D9%84/">دایتل</a> <a class="post-tag" href="/tags/%DB%8C%D8%A7%D8%AF%DA%AF%DB%8C%D8%B1%DB%8C/">یادگیری</a> <a class="post-tag" href="/tags/concurrency-in-action/">concurrency in action</a> <a class="post-tag" href="/tags/concurrent-processing/">concurrent processing</a> <a class="post-tag" href="/tags/%D8%A8%D8%B1%D9%86%D8%A7%D9%85%D9%87-%D9%86%D9%88%DB%8C%D8%B3%DB%8C-%DA%86%D9%86%D8%AF-%D9%86%D8%AE%DB%8C/">برنامه نویسی چند نخی</a> <a class="post-tag" href="/tags/%D8%B3%DB%8C-%DB%B1%DB%B7/">سی++۱۷</a> <a class="post-tag" href="/tags/%D9%85%D9%88%D8%A7%D8%B2%DB%8C-%DA%A9%D8%A7%D8%B1%DB%8C/">موازی کاری</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/concurrency-in-cpp-chapter3-3/"><div class="card-body"> <span class="timeago small" > Apr 8, 2021 <i class="unloaded">2021-04-08T00:00:00+04:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>همزمانی در سی++(۳): Dead Lock ها</h3><div class="text-muted small"><p> خب در پست قبل این مسئله که ترد ها برای استفاده از داده باهم مسابقه می‌دن رو کمی بررسی کردیم و یک راه حل دم دست هم براش پیشنهاد دادیم. توی این پست میخوایم در مورد مشکلی بحث کنیم که یجورایی برعکس Rac...</p></div></div></a></div><div class="card"> <a href="/posts/concurrency-in-cpp-chapter3-4/"><div class="card-body"> <span class="timeago small" > Apr 12, 2021 <i class="unloaded">2021-04-12T00:00:00+04:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>همزمانی در سی++(۴): ژانگولر بازی با mutex و کارهای دیگر</h3><div class="text-muted small"><p> در این پست درباره اینکه چطور می‌تونیم یک سری ژانگولر بازی با mutex ها دربیاریم صحبت می‌کنیم. مثلا چطور میوتکس ها رو بین scope ها جابجا کنیم، یا چطور با انعطاف بیشتری نسبت به قفل کردن mutex ها اقدام...</p></div></div></a></div><div class="card"> <a href="/posts/concurrency-in-cpp-chapter3-5/"><div class="card-body"> <span class="timeago small" > Apr 18, 2021 <i class="unloaded">2021-04-18T00:00:00+04:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>همزمانی در سی++(۵): جایگزین های mutex</h3><div class="text-muted small"><p> در پست قبل درباره اینکه چه کار های دیگه‌ای میشه با mutex ها انجام داد صحبت کردیم و همچنین کلاس std::unique_ptr رو معرفی کردیم که دست ما رو برای استفاده از mutex ها باز می‌کنه. در این پست قراره که ج...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/smart-pointers-shared-ptr/" class="btn btn-outline-primary" prompt="قبلی"><p>اشاره گر های هوشمند: shared_ptr</p></a> <a href="/posts/starting-new-blog/" class="btn btn-outline-primary" prompt="بعدی"><p>شروع وبلاگ جدید</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div><div class="footer-right" style="direction: rtl; text-align: right;"><p class="mb-0"> <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">مطالب این وبسایت تحت مجوز CC-BY-4.0 منتشر می‌شوند</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/%D8%B3%DB%8C/">سی++</a> <a class="post-tag" href="/tags/inner-struggle/">Inner Struggle</a> <a class="post-tag" href="/tags/%D8%AF%D8%A7%DB%8C%D8%AA%D9%84/">دایتل</a> <a class="post-tag" href="/tags/%DB%8C%D8%A7%D8%AF%DA%AF%DB%8C%D8%B1%DB%8C/">یادگیری</a> <a class="post-tag" href="/tags/concurrency-in-action/">concurrency in action</a> <a class="post-tag" href="/tags/concurrent-processing/">concurrent processing</a> <a class="post-tag" href="/tags/%D8%A8%D8%B1%D9%86%D8%A7%D9%85%D9%87-%D9%86%D9%88%DB%8C%D8%B3%DB%8C-%DA%86%D9%86%D8%AF-%D9%86%D8%AE%DB%8C/">برنامه نویسی چند نخی</a> <a class="post-tag" href="/tags/%D8%B3%DB%8C-%DB%B1%DB%B7/">سی++۱۷</a> <a class="post-tag" href="/tags/%D9%85%D9%88%D8%A7%D8%B2%DB%8C-%DA%A9%D8%A7%D8%B1%DB%8C/">موازی کاری</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.seedpuller.ir{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
